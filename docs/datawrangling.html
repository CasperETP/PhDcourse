<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data wrangling and tidy data | The data-wrangling and omics course for R novices</title>
  <meta name="description" content="A tutorial on how to do data-wrangling and analysing omics data" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data wrangling and tidy data | The data-wrangling and omics course for R novices" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A tutorial on how to do data-wrangling and analysing omics data" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data wrangling and tidy data | The data-wrangling and omics course for R novices" />
  
  <meta name="twitter:description" content="A tutorial on how to do data-wrangling and analysing omics data" />
  

<meta name="author" content="CETP" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataintro.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to this course</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Course overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#what-can-you-expect"><i class="fa fa-check"></i><b>2.1</b> What can you expect</a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#general-learning-outcomes"><i class="fa fa-check"></i><b>2.2</b> General learning outcomes</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#our-workflow-plus-the-tidy-data-workflow"><i class="fa fa-check"></i><b>2.3</b> Our workflow plus the Tidy data workflow</a></li>
<li class="chapter" data-level="2.4" data-path="overview.html"><a href="overview.html#working-with-data-that-is-not-your-own"><i class="fa fa-check"></i><b>2.4</b> Working with data that is not your own</a></li>
<li class="chapter" data-level="2.5" data-path="overview.html"><a href="overview.html#goals-of-this-course"><i class="fa fa-check"></i><b>2.5</b> Goals of this course</a></li>
<li class="chapter" data-level="2.6" data-path="overview.html"><a href="overview.html#prerequisites"><i class="fa fa-check"></i><b>2.6</b> Prerequisites</a></li>
<li class="chapter" data-level="2.7" data-path="overview.html"><a href="overview.html#credit"><i class="fa fa-check"></i><b>2.7</b> Credit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataintro.html"><a href="dataintro.html"><i class="fa fa-check"></i><b>3</b> Super quick intro to coding and data in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dataintro.html"><a href="dataintro.html#codingprogramming-in-r"><i class="fa fa-check"></i><b>3.1</b> Coding/programming in R</a></li>
<li class="chapter" data-level="3.2" data-path="dataintro.html"><a href="dataintro.html#basic-terminology-in-r"><i class="fa fa-check"></i><b>3.2</b> Basic terminology in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="dataintro.html"><a href="dataintro.html#ex1"><i class="fa fa-check"></i><b>3.2.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dataintro.html"><a href="dataintro.html#error-messages"><i class="fa fa-check"></i><b>3.3</b> Error messages</a></li>
<li class="chapter" data-level="3.4" data-path="dataintro.html"><a href="dataintro.html#coding-tips-and-tricks"><i class="fa fa-check"></i><b>3.4</b> Coding tips and tricks</a></li>
<li class="chapter" data-level="3.5" data-path="dataintro.html"><a href="dataintro.html#installpackages"><i class="fa fa-check"></i><b>3.5</b> Install and load package</a></li>
<li class="chapter" data-level="3.6" data-path="dataintro.html"><a href="dataintro.html#exercise-answers"><i class="fa fa-check"></i><b>3.6</b> Exercise answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i><b>4</b> Data wrangling and tidy data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="datawrangling.html"><a href="datawrangling.html#packages-required"><i class="fa fa-check"></i><b>4.1</b> Packages required</a></li>
<li class="chapter" data-level="4.2" data-path="datawrangling.html"><a href="datawrangling.html#the-pipe-and-very-useful-functions"><i class="fa fa-check"></i><b>4.2</b> The pipe and very useful functions</a></li>
<li class="chapter" data-level="4.3" data-path="datawrangling.html"><a href="datawrangling.html#penguins"><i class="fa fa-check"></i><b>4.3</b> Penguins!</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="datawrangling.html"><a href="datawrangling.html#ex2"><i class="fa fa-check"></i><b>4.3.1</b> Your turn - Look at the dataset</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="datawrangling.html"><a href="datawrangling.html#more-handy-functions"><i class="fa fa-check"></i><b>4.4</b> More handy functions</a></li>
<li class="chapter" data-level="4.5" data-path="datawrangling.html"><a href="datawrangling.html#one-way-to-deal-with-missing-values"><i class="fa fa-check"></i><b>4.5</b> One way to deal with missing values</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="datawrangling.html"><a href="datawrangling.html#ex3"><i class="fa fa-check"></i><b>4.5.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="datawrangling.html"><a href="datawrangling.html#back-to-the-future"><i class="fa fa-check"></i><b>4.6</b> Back to the future</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="datawrangling.html"><a href="datawrangling.html#get-summary-of-a-statistic-but-grouping-on-another-variable"><i class="fa fa-check"></i><b>4.6.1</b> Get summary of a statistic, but grouping on another variable</a></li>
<li class="chapter" data-level="4.6.2" data-path="datawrangling.html"><a href="datawrangling.html#grouping-on-more-than-one-variable"><i class="fa fa-check"></i><b>4.6.2</b> Grouping on more than one variable</a></li>
<li class="chapter" data-level="4.6.3" data-path="datawrangling.html"><a href="datawrangling.html#remove-nas-sex-variable-and-sort-by-mean-body-size"><i class="fa fa-check"></i><b>4.6.3</b> Remove NAs sex variable and sort by mean body size</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="datawrangling.html"><a href="datawrangling.html#lets-look-at-a-dataset-from-the-internet"><i class="fa fa-check"></i><b>4.7</b> Lets look at a dataset from the internet</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="datawrangling.html"><a href="datawrangling.html#comma-separated-csv"><i class="fa fa-check"></i><b>4.7.1</b> comma separated (csv)</a></li>
<li class="chapter" data-level="4.7.2" data-path="datawrangling.html"><a href="datawrangling.html#construct-new-date-variable-and-look-at-life-expectancy"><i class="fa fa-check"></i><b>4.7.2</b> Construct new date variable and look at life expectancy</a></li>
<li class="chapter" data-level="4.7.3" data-path="datawrangling.html"><a href="datawrangling.html#ex4"><i class="fa fa-check"></i><b>4.7.3</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="datawrangling.html"><a href="datawrangling.html#exercise-answers-1"><i class="fa fa-check"></i><b>4.8</b> Exercise answers</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The data-wrangling and omics course for R novices</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datawrangling" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Data wrangling and tidy data<a href="datawrangling.html#datawrangling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="cartoonscrubdata.jpg" /></p>
<div id="packages-required" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Packages required<a href="datawrangling.html#packages-required" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following packages are required. If you need to go back and check how installing a package is done see the section 3.5(#installpackages).</p>
<p>library(dplyr).<br />
library(ggplot2).<br />
library(readr).<br />
library(tidyr).<br />
library(broom).<br />
library(palmerpenguins).</p>
<p>This chapter will introduce you to data wrangling with an emphasis on the <code>dplyr</code> package along with other helpful functions. You will see how powerful wrangling can be and how it can be like a magic wand to transform data into your specific needs. The key functions include but are not limited to:</p>
</div>
<div id="the-pipe-and-very-useful-functions" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> The pipe and very useful functions<a href="datawrangling.html#the-pipe-and-very-useful-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The overarching function which makes us able to combine functions and subsetting is <strong>the pipe</strong>. And what is a pipe? Pipes are a neat way to tie together several dataframes/functions into a chain of actions. It makes coding easier to understand and is therefore a better style of coding. It looks like this <code>%&gt;%</code>. For instance taking the mean of the first two rows of the <code>my_df</code> dataframe can be done like so:
<code>my_df[1:2,"Grades"] %&gt;% mean</code>. Learning to use the pipe to your advantage is learning to code. Luckily it all comes naturally when working with the following functions:</p>
<ol style="list-style-type: decimal">
<li><code>left_join()</code> merge two data frames together using a key column. This function (along with its cousin functions <code>right_join()</code> and <code>join()</code> etc.) is the bread and butter of working with many data types that needs to be merged and analysed. For example</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="datawrangling.html#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr) </span>
<span id="cb1-2"><a href="datawrangling.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  my_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="datawrangling.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;Villy&quot;</span>, <span class="st">&quot;Søren&quot;</span>, <span class="st">&quot;Karl&quot;</span>, <span class="st">&quot;Benny&quot;</span>, <span class="st">&quot;Siri&quot;</span>),</span>
<span id="cb1-4"><a href="datawrangling.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Grades =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">60</span>),</span>
<span id="cb1-5"><a href="datawrangling.html#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;boy&quot;</span>, <span class="st">&quot;boy&quot;</span>, <span class="st">&quot;boy&quot;</span>, <span class="st">&quot;boy&quot;</span>, <span class="st">&quot;girl&quot;</span>)) </span>
<span id="cb1-6"><a href="datawrangling.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  other_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;boy&quot;</span>, <span class="st">&quot;girl&quot;</span>), <span class="at">description =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))</span>
<span id="cb1-7"><a href="datawrangling.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  left_joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(my_data, other_data, <span class="at">by =</span> <span class="st">&quot;gender&quot;</span>) </span>
<span id="cb1-8"><a href="datawrangling.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-9"><a href="datawrangling.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  left_joined_data</span></code></pre></div>
<pre><code>##   names Grades gender description
## 1 Villy    100    boy        Male
## 2 Søren     20    boy        Male
## 3  Karl     40    boy        Male
## 4 Benny     30    boy        Male
## 5  Siri     60   girl      Female</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><code>mutate()</code> construct/reconstruct a column using a newly defined column name. This function is useful to generate a new columns that modify existing ones often using a conditional to do so. Now using the same data as above:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="datawrangling.html#cb3-1" aria-hidden="true" tabindex="-1"></a>  mutated_data <span class="ot">&lt;-</span> my_data <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="datawrangling.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Grades_scaled =</span> Grades <span class="sc">/</span> <span class="fu">max</span>(Grades))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>glimpse()</code> take a sneak peak at a dataset. Useful for getting the dimensions of the data and the type of data contained in the columns. Now look at the newly constructed column</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="datawrangling.html#cb4-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>(mutated_data)</span></code></pre></div>
<pre><code>## Rows: 5
## Columns: 4
## $ names         &lt;chr&gt; &quot;Villy&quot;, &quot;Søren&quot;, &quot;Karl&quot;, &quot;Benny&quot;, &quot;Siri&quot;
## $ Grades        &lt;dbl&gt; 100, 20, 40, 30, 60
## $ gender        &lt;chr&gt; &quot;boy&quot;, &quot;boy&quot;, &quot;boy&quot;, &quot;boy&quot;, &quot;girl&quot;
## $ Grades_scaled &lt;dbl&gt; 1.0, 0.2, 0.4, 0.3, 0.6</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><code>count()</code> counts the n of each unique value in a column. Usefull to combine with mutate to see the counts of the newly constructed column.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="datawrangling.html#cb6-1" aria-hidden="true" tabindex="-1"></a>  counted_data <span class="ot">&lt;-</span> <span class="fu">count</span>(my_data, gender)</span>
<span id="cb6-2"><a href="datawrangling.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  counted_data</span></code></pre></div>
<pre><code>##   gender n
## 1    boy 4
## 2   girl 1</code></pre>
<ol start="5" style="list-style-type: decimal">
<li><code>arrange()</code> reorder the rows of a dataframe. For example, sort the rows of a dataset in descending order of the column height.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="datawrangling.html#cb8-1" aria-hidden="true" tabindex="-1"></a>arranged_data <span class="ot">&lt;-</span> <span class="fu">arrange</span>(my_data, <span class="fu">desc</span>(Grades))</span>
<span id="cb8-2"><a href="datawrangling.html#cb8-2" aria-hidden="true" tabindex="-1"></a>arranged_data</span></code></pre></div>
<pre><code>##   names Grades gender
## 1 Villy    100    boy
## 2  Siri     60   girl
## 3  Karl     40    boy
## 4 Benny     30    boy
## 5 Søren     20    boy</code></pre>
<ol start="5" style="list-style-type: decimal">
<li><p><code>select()</code> select columns using indexing or strings. e.g. <code>my_df %&gt;% select("names")</code>.</p></li>
<li><p><code>filter()</code> the rows of a dataframe based on a filter, e.g. thresholds. It is similar to the example shown in the introduction, where we used old school filtering on my_df dataframe <code>my_df[my_df$names %in% c("Karl","Villy"),]</code>. Using the filter function and pipes you can do it like this: <code>my_df %&gt;% filter(names %in% c("Karl","Villy"))</code>.</p></li>
<li><p><code>summarise()</code> a dataframe using one or more of its columns/variables with a summary statistic. Such examples could be the median or the mean and an example look like this: <code>my_df %&gt;% summarise(mean = mean(Grades))</code>. This function can be very powerful when combined with the <code>group_by</code> function.</p></li>
<li><p><code>group_by()</code> is a dplyr way of grouping rows, it is a way to assign different rows to a group and do statistical reporting on every specific group in the data set. An example require us to add a third column to <code>my_df</code> like this:
<code>my_df &lt;- my_df %&gt;% mutate(gender = c("boy","boy","boy","boy","girl"))</code>. Now using this new <code>my_df</code> we can <code>group_by</code> on the gender column and calculate the median on this group:</p></li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="datawrangling.html#cb10-1" aria-hidden="true" tabindex="-1"></a>my_df <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="datawrangling.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="datawrangling.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">median</span>(Grades)) </span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   gender `median(Grades)`
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 boy                  35
## 2 girl                 60</code></pre>
<p><img src="wide_to_longer.png" style="width:50.0%" /> <img src="longer_to_wide.png" style="width:50.0%" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Sometimes you are interest in changing the format of the data, i.e. reshaping the way it is represented in R. Like in the two figures above, you sometimes want to go from a “long” format to a “wide” or vice versa. To do so we use the R functions <code>pivot_longer()</code> and <code>pivot_wider()</code> This will come in handy when you start to do modelling tomorrow. But for now, we will first understand how
<code>pivot_longer()</code> works.</li>
</ol>
<p>For this we will use the left_joined_data from above. First lets look at the data again:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="datawrangling.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(left_joined_data)</span>
<span id="cb12-2"><a href="datawrangling.html#cb12-2" aria-hidden="true" tabindex="-1"></a>df_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(left_joined_data, <span class="at">names_from =</span> names, <span class="at">values_from =</span> Grades)  </span>
<span id="cb12-3"><a href="datawrangling.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_wide)</span></code></pre></div>
<p>This results in a dataset where each unique value in the “names” column becomes a separate column, and the corresponding “Grades” values are filled into those columns. The “gender” and “description” columns remain unchanged. Keep in mind that we lose some of the information available in the left_joined_data.</p>
<p>Lets try to revert the <code>df_wide</code> to long format again.</p>
<p><code>df_long_again &lt;- pivot_longer(df_wide, cols = -c(gender, description), names_to = "names", values_to = "Grades")</code>.</p>
<p><img src="lter_penguins.png" /></p>
</div>
<div id="penguins" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Penguins!<a href="datawrangling.html#penguins" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we are going to use the functions described above on the penguin dataset. The data has been collected by <a href="https://gormankb.github.io/">Dr. Kirstin Gorman</a> at the Palmer station, Antartica LTER. So real data collected for a purpose and published in a scientific journal.</p>
<p><code>library(palmerpenguins)</code></p>
<div id="ex2" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Your turn - Look at the dataset<a href="datawrangling.html#ex2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now look at the dataset using <code>glimpse()</code> in the console, now try to look at the dataset using
<code>str()</code> again you get information about the dataset. Please use one minute and compare the two methods to look at structure of the data.
Which one do you prefer and why?</p>
<p>Exercise 2.</p>
<ol style="list-style-type: decimal">
<li>You can input several grouping variables into <code>group_by(var1,var2)</code>. Now use this information
to output the mean length of the flippers for species across islands, meaning for e.g. Adelie penguins
you will have three values. Remember that <code>mean</code> can handle NA values in your dataset, you just have to tell it
to do so.</li>
</ol>
</div>
</div>
<div id="more-handy-functions" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> More handy functions<a href="datawrangling.html#more-handy-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often, we are interested in a summary of information for many columns at once and thus we are not only looking at e.g. flipper_length across species and islands, but rather all measurements across species and islands. The reason to this more thorough data description is to gain better insight into the dataset. Better insights leads to better scientific questions.</p>
<ol style="list-style-type: decimal">
<li><code>across()</code> is a function that makes it easy to transform/summarise multiple columns. It needs a <em>function</em> to apply to these columns, that could be <code>median</code> or <code>mean()</code>. Also, it is often combined with functions like <code>mutate()</code> and <code>summarise()</code> to generate new columns using transformation on existing columns. Furthermore, it is also often combined with functions that informs <code>across()</code> on which columns to look at. For instance, <code>across()</code> can be combined with <code>starts_with()</code> and <code>where()</code>.
OK enough text, now to an example that makes sense. Again looking at the penguins dataset, lets try to combine these functions to get an intuition about how they work together:</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="datawrangling.html#cb13-1" aria-hidden="true" tabindex="-1"></a>  penguins <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="datawrangling.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species,island) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="datawrangling.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;bill&quot;</span>),<span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;species&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 5 × 4
## # Groups:   species [3]
##   species   island    bill_length_mm bill_depth_mm
##   &lt;fct&gt;     &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
## 1 Adelie    Biscoe              39.0          18.4
## 2 Adelie    Dream               38.5          18.3
## 3 Adelie    Torgersen           39.0          18.4
## 4 Chinstrap Dream               48.8          18.4
## 5 Gentoo    Biscoe              47.5          15.0</code></pre>
<p>You can see that this gives a nice overview of the bill lengths across the species across the islands. One takeaway
one this would be that the difference in bill length seems less influenced by islands and more influenced by species.</p>
</div>
<div id="one-way-to-deal-with-missing-values" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> One way to deal with missing values<a href="datawrangling.html#one-way-to-deal-with-missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="datawrangling.html#cb16-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> penguins</span>
<span id="cb16-2"><a href="datawrangling.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(penguins))</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<p>The penguins dataset is not perfect. BUT, we can wave our magic data wand to impute the missing values. What is imputation? it is best-guess construction, meaning we already know a lot about the penguins so we fill in the missing values with guesses. It is not cheating, it is done all the time in research.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="datawrangling.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the dataset so we can modify the data frame without having to reload the data</span></span>
<span id="cb18-2"><a href="datawrangling.html#cb18-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> penguins</span>
<span id="cb18-3"><a href="datawrangling.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># how many missing in the flipper length?</span></span>
<span id="cb18-4"><a href="datawrangling.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>flipper_length_mm))</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>Now - waving the magic data wand - we impute</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="datawrangling.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values with mean imputation for the &#39;flipper_length_mm&#39; column</span></span>
<span id="cb20-2"><a href="datawrangling.html#cb20-2" aria-hidden="true" tabindex="-1"></a>data_imputed <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="datawrangling.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flipper_length_mm =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(flipper_length_mm), </span>
<span id="cb20-4"><a href="datawrangling.html#cb20-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mean</span>(flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb20-5"><a href="datawrangling.html#cb20-5" aria-hidden="true" tabindex="-1"></a>                                    flipper_length_mm))</span></code></pre></div>
<p>What is going on? Here we are being aided by the
<code>ifelse</code> function which ask questions about the data, we pair this function with mutate and reconstruct the flipper_length_mm imputing missing values.</p>
<p>Typically though, we have a lot of variables that needs to be imputed and
<em>even though we hate to admit it, we know that we are lazy, and laziness is the super fuel of the efficient programmer!</em>
So below is a way to to the same, but instead of focusing on a specific column we use the
<code>mutate_if</code> function to find all numeric columns in the dataset and do the same.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="datawrangling.html#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impute missing values with mean imputation for numeric columns</span></span>
<span id="cb21-2"><a href="datawrangling.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  data_imputed <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="datawrangling.html#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .))</span></code></pre></div>
<div id="ex3" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Your turn<a href="datawrangling.html#ex3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exercise 3.</p>
<p>Sometimes the variables you need impute are not just continuous variables like height or flipper length in mm. So what do we do then? Well, we guess, but instead of using the information in the column you want to impute, you use supplementary information in the adjacent columns. How can we do that? Well consider the column in the penguins data set which contains the gender of the penguins. We would not gain anything from replacing NA values with the mean of that column. In the natural world, species are often sexually dimorphic, which are fancy words for differences in size/color between sexes. We want to leverage this information to guess at the gender. So we can guess based on body size because we know sexes often differ in size. But first, we need to check if that is true for penguins.</p>
<ol style="list-style-type: decimal">
<li>So assuming you have the data set called <strong>data_imputed</strong> made above where all the continuous measurements have been mean imputed you can address the missing sex problem for the <em>Adelie</em> species.</li>
</ol>
<p>Maybe you can learn something about sexual dimorphism from these plot and table?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="datawrangling.html#cb22-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(<span class="fu">is.na</span>(data_imputed<span class="sc">$</span>sex),data_imputed<span class="sc">$</span>species)  </span></code></pre></div>
<pre><code>##        
##         Adelie Chinstrap Gentoo
##   FALSE    146        68    119
##   TRUE       6         0      5</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="datawrangling.html#cb24-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data_imputed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="st">&quot;Adelie&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="datawrangling.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a href="datawrangling.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Body mass vs. flipper length by species&quot;</span>)</span></code></pre></div>
<p><img src="data_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
</div>
<div id="back-to-the-future" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Back to the future<a href="datawrangling.html#back-to-the-future" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lets play a little more with grouping in the penguins dataset. Lets try to ignore the missing values for now instead of imputing them.</p>
<div id="get-summary-of-a-statistic-but-grouping-on-another-variable" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Get summary of a statistic, but grouping on another variable<a href="datawrangling.html#get-summary-of-a-statistic-but-grouping-on-another-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="datawrangling.html#cb25-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="datawrangling.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="datawrangling.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb25-4"><a href="datawrangling.html#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_bm =</span><span class="fu">mean</span>(body_mass_g, <span class="at">na.rm=</span>T),</span>
<span id="cb25-5"><a href="datawrangling.html#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_bm   =</span><span class="fu">sd</span>(body_mass_g, <span class="at">na.rm=</span>T),</span>
<span id="cb25-6"><a href="datawrangling.html#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n            =</span> <span class="fu">n</span>()</span>
<span id="cb25-7"><a href="datawrangling.html#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   species   mean_bm sd_bm     n
##   &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 Adelie      3701.  459.   152
## 2 Chinstrap   3733.  384.    68
## 3 Gentoo      5076.  504.   124</code></pre>
</div>
<div id="grouping-on-more-than-one-variable" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Grouping on more than one variable<a href="datawrangling.html#grouping-on-more-than-one-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="datawrangling.html#cb27-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="datawrangling.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, sex) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="datawrangling.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb27-4"><a href="datawrangling.html#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_bm =</span><span class="fu">mean</span>(body_mass_g, <span class="at">na.rm=</span>T),</span>
<span id="cb27-5"><a href="datawrangling.html#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_bm   =</span><span class="fu">sd</span>(body_mass_g, <span class="at">na.rm=</span>T),</span>
<span id="cb27-6"><a href="datawrangling.html#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n            =</span> <span class="fu">n</span>()</span>
<span id="cb27-7"><a href="datawrangling.html#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;species&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 8 × 5
## # Groups:   species [3]
##   species   sex    mean_bm sd_bm     n
##   &lt;fct&gt;     &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 Adelie    female   3369.  269.    73
## 2 Adelie    male     4043.  347.    73
## 3 Adelie    &lt;NA&gt;     3540   477.     6
## 4 Chinstrap female   3527.  285.    34
## 5 Chinstrap male     3939.  362.    34
## 6 Gentoo    female   4680.  282.    58
## 7 Gentoo    male     5485.  313.    61
## 8 Gentoo    &lt;NA&gt;     4588.  338.     5</code></pre>
</div>
<div id="remove-nas-sex-variable-and-sort-by-mean-body-size" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Remove NAs sex variable and sort by mean body size<a href="datawrangling.html#remove-nas-sex-variable-and-sort-by-mean-body-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="datawrangling.html#cb30-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="datawrangling.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="datawrangling.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, sex) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="datawrangling.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb30-5"><a href="datawrangling.html#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_bm =</span><span class="fu">mean</span>(body_mass_g, <span class="at">na.rm=</span>T),</span>
<span id="cb30-6"><a href="datawrangling.html#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_bm   =</span><span class="fu">sd</span>(body_mass_g, <span class="at">na.rm=</span>T),</span>
<span id="cb30-7"><a href="datawrangling.html#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n            =</span> <span class="fu">n</span>()</span>
<span id="cb30-8"><a href="datawrangling.html#cb30-8" aria-hidden="true" tabindex="-1"></a>)<span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="datawrangling.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">desc</span>(mean_bm))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;species&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 × 5
## # Groups:   species [3]
##   species   sex    mean_bm sd_bm     n
##   &lt;fct&gt;     &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 Gentoo    male     5485.  313.    61
## 2 Gentoo    female   4680.  282.    58
## 3 Adelie    male     4043.  347.    73
## 4 Chinstrap male     3939.  362.    34
## 5 Chinstrap female   3527.  285.    34
## 6 Adelie    female   3369.  269.    73</code></pre>
<p>Great! That was the fast introduction to penguins. Think about what you learned from this. <strong>The meta-information that
you gather from doing exercises as the ones above is the real magic</strong>. Therefore, as always, look at your data in different ways before diving in.</p>
</div>
</div>
<div id="lets-look-at-a-dataset-from-the-internet" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Lets look at a dataset from the internet<a href="datawrangling.html#lets-look-at-a-dataset-from-the-internet" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Open this link in a new tab by copy-pasting and save it to your computer using right-click (<a href="https://raw.githubusercontent.com/zief0002/miniature-garbanzo/main/data/gapminder.csv" class="uri">https://raw.githubusercontent.com/zief0002/miniature-garbanzo/main/data/gapminder.csv</a>).
Save it as “gapminder2017”.</p>
<div id="comma-separated-csv" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> comma separated (csv)<a href="datawrangling.html#comma-separated-csv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>try reading it in using read csv, the file ending is automatically put on there, so even though you did not name it gapminder2017.csv, that is the name it will get.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="datawrangling.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read csv can create in comma-separated files, read.table can be used to read in tab separated tables</span></span>
<span id="cb33-2"><a href="datawrangling.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># BUT in general, you just need to specify what separated your columns and if the data has a header</span></span>
<span id="cb33-3"><a href="datawrangling.html#cb33-3" aria-hidden="true" tabindex="-1"></a>gapminder2017 <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;~/241023_phdcourse/data/gapminder2017.csv&quot;</span>)</span>
<span id="cb33-4"><a href="datawrangling.html#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="datawrangling.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gapminder2017)</span></code></pre></div>
<pre><code>## Rows: 193
## Columns: 8
## $ country      &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Andorra&quot;, &quot;Angola&quot;,…
## $ region       &lt;chr&gt; &quot;Asia&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Americas…
## $ income       &lt;dbl&gt; 2.03, 13.30, 11.60, 58.30, 6.93, 21.00, 22.70, 12.70, 49.…
## $ income_level &lt;chr&gt; &quot;Level 1&quot;, &quot;Level 3&quot;, &quot;Level 3&quot;, &quot;Level 4&quot;, &quot;Level 2&quot;, &quot;L…
## $ life_exp     &lt;dbl&gt; 62.7, 78.4, 76.0, 82.1, 64.6, 76.2, 76.5, 75.6, 82.9, 82.…
## $ co2          &lt;dbl&gt; 0.254, 1.590, 3.690, 6.120, 1.120, 5.880, 4.410, 1.890, 1…
## $ co2_change   &lt;chr&gt; &quot;increase&quot;, &quot;increase&quot;, &quot;increase&quot;, &quot;decrease&quot;, &quot;decrease…
## $ population   &lt;dbl&gt; 37.2000, 2.8800, 42.2000, 0.0770, 30.8000, 0.0963, 44.400…</code></pre>
<p>Plotting is useful for understanding your data, in this case, we can plot the life expectancy and co2 across regions.
We will back to plotting much more so dont worry if you dont understand it all right now.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="datawrangling.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder2017, <span class="fu">aes</span>(<span class="at">x =</span> life_exp, <span class="at">y =</span> co2, <span class="at">color =</span> region)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="datawrangling.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co"># Add points for each data point</span></span>
<span id="cb35-3"><a href="datawrangling.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  <span class="co"># Add linear trendlines without confidence bands</span></span>
<span id="cb35-4"><a href="datawrangling.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Life Expectancy vs. CO2 Levels across Regions (2017)&quot;</span>, <span class="at">x =</span> <span class="st">&quot;CO2 Levels&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Life Expectancy&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="data_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>However, what we want is not a point estimate for the year 2017, we want the change in life expectancy over time across regions, but not per year. We want to do it per 5 years to remove the uncertainty given by yearly measurements also we only want to look at the Nordic countries. The full dataset for gapminder is available in the R package <code>gapminder</code> install this if you have not done so already.</p>
<p>For an overview of the data, look at this plot</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="datawrangling.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb37-2"><a href="datawrangling.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="datawrangling.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For Denmark see the trend in life expectancy</span></span>
<span id="cb37-4"><a href="datawrangling.html#cb37-4" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(continent <span class="sc">%in%</span> <span class="st">&quot;Europe&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="datawrangling.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb37-6"><a href="datawrangling.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-7"><a href="datawrangling.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)  <span class="co"># Add linear trendlines without confidence bands</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="data_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="construct-new-date-variable-and-look-at-life-expectancy" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Construct new date variable and look at life expectancy<a href="datawrangling.html#construct-new-date-variable-and-look-at-life-expectancy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often, we are given raw data and we need to invent a new feature that incorporates the flaws of our data while still being useful. For example, yearly estimates might not be available and thus we want to contruct a 5 year period increase to remove some of uncertainty introduced by this effect.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="datawrangling.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for Nordic countries in the &#39;gapminder&#39; dataset</span></span>
<span id="cb39-2"><a href="datawrangling.html#cb39-2" aria-hidden="true" tabindex="-1"></a>nordic_countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Denmark&quot;</span>, <span class="st">&quot;Finland&quot;</span>, <span class="st">&quot;Iceland&quot;</span>, <span class="st">&quot;Norway&quot;</span>, <span class="st">&quot;Sweden&quot;</span>)</span>
<span id="cb39-3"><a href="datawrangling.html#cb39-3" aria-hidden="true" tabindex="-1"></a>nordic_data <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">%in%</span> nordic_countries)</span>
<span id="cb39-4"><a href="datawrangling.html#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="datawrangling.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date interval of five years</span></span>
<span id="cb39-6"><a href="datawrangling.html#cb39-6" aria-hidden="true" tabindex="-1"></a>nordic_data <span class="ot">&lt;-</span> nordic_data <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="datawrangling.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_interval =</span> year <span class="sc">%/%</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">5</span>)  <span class="co"># Create intervals of 5 years</span></span>
<span id="cb39-8"><a href="datawrangling.html#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="datawrangling.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize life expectancy for the Nordic countries within the 5-year intervals</span></span>
<span id="cb39-10"><a href="datawrangling.html#cb39-10" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> nordic_data <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="datawrangling.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year_interval) <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="datawrangling.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_life_expectancy =</span> <span class="fu">mean</span>(lifeExp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="datawrangling.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the summarized data</span></span>
<span id="cb41-2"><a href="datawrangling.html#cb41-2" aria-hidden="true" tabindex="-1"></a>summary</span></code></pre></div>
<pre><code>## # A tibble: 60 × 3
## # Groups:   country [5]
##    country year_interval avg_life_expectancy
##    &lt;fct&gt;           &lt;dbl&gt;               &lt;dbl&gt;
##  1 Denmark          1950                70.8
##  2 Denmark          1955                71.8
##  3 Denmark          1960                72.4
##  4 Denmark          1965                73.0
##  5 Denmark          1970                73.5
##  6 Denmark          1975                74.7
##  7 Denmark          1980                74.6
##  8 Denmark          1985                74.8
##  9 Denmark          1990                75.3
## 10 Denmark          1995                76.1
## # ℹ 50 more rows</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="datawrangling.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year_interval), <span class="at">y =</span> avg_life_expectancy, <span class="at">fill =</span> country)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="datawrangling.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="datawrangling.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average Life Expectancy of Nordic Countries by 5-Year Intervals&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year Interval&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Average Life Expectancy&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="datawrangling.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)  <span class="co"># Adjust the color palette as desired</span></span></code></pre></div>
<p><img src="data_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="ex4" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> Your turn<a href="datawrangling.html#ex4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exercise 4.</p>
<p>Now using the dataset <strong>summary</strong> we want to see how the percentwise increase between 1950 and year 2005 differs
between the Nordic countries</p>
<ol style="list-style-type: decimal">
<li>Create a new dataframe which contains the relative increase in life expectancy across Nordic countries between years and arrange from highest to lowest</li>
</ol>
</div>
</div>
<div id="exercise-answers-1" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Exercise answers<a href="datawrangling.html#exercise-answers-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The answer to <a href="datawrangling.html#ex2">exercise 2</a> can be seen here:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="datawrangling.html#cb44-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island,species) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">mean</span>(flipper_length_mm,<span class="at">na.rm=</span>T))</span></code></pre></div>
<p>The answer to <a href="datawrangling.html#ex3">exercise 3</a> can be seen here:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="datawrangling.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_imputed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="st">&quot;Adelie&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb45-2"><a href="datawrangling.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-3"><a href="datawrangling.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Body mass vs. flipper length by species&quot;</span>)</span>
<span id="cb45-4"><a href="datawrangling.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="datawrangling.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># here we input females as our best guess</span></span>
<span id="cb45-6"><a href="datawrangling.html#cb45-6" aria-hidden="true" tabindex="-1"></a>data_imputed_adelie <span class="ot">&lt;-</span> data_imputed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="st">&quot;Adelie&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="datawrangling.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_char =</span> <span class="fu">as.character</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="datawrangling.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_imputed =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sex_char),<span class="st">&quot;female&quot;</span>,sex_char))</span>
<span id="cb45-9"><a href="datawrangling.html#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="datawrangling.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_imputed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="st">&quot;Gentoo&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb45-11"><a href="datawrangling.html#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-12"><a href="datawrangling.html#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Body mass vs. flipper length by species&quot;</span>)</span>
<span id="cb45-13"><a href="datawrangling.html#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="datawrangling.html#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># same for Gentoo</span></span>
<span id="cb45-15"><a href="datawrangling.html#cb45-15" aria-hidden="true" tabindex="-1"></a>data_imputed_Gentoo <span class="ot">&lt;-</span> data_imputed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="st">&quot;Gentoo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-16"><a href="datawrangling.html#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_char =</span> <span class="fu">as.character</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-17"><a href="datawrangling.html#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_imputed =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sex_char),<span class="st">&quot;female&quot;</span>,sex_char))</span>
<span id="cb45-18"><a href="datawrangling.html#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="datawrangling.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># so instead of doing separate datasets</span></span>
<span id="cb45-20"><a href="datawrangling.html#cb45-20" aria-hidden="true" tabindex="-1"></a>data_sex_imputed <span class="ot">&lt;-</span> data_imputed <span class="sc">%&gt;%</span> </span>
<span id="cb45-21"><a href="datawrangling.html#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_char =</span> <span class="fu">as.character</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-22"><a href="datawrangling.html#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_imputed =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sex_char),<span class="st">&quot;female&quot;</span>,sex_char))</span></code></pre></div>
<p>The answer to <a href="datawrangling.html#ex4">exercise 4</a> can be seen here:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="datawrangling.html#cb46-1" aria-hidden="true" tabindex="-1"></a>summary <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="datawrangling.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="datawrangling.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rel_dif =</span> <span class="fu">max</span>(avg_life_expectancy)<span class="sc">/</span><span class="fu">min</span>(avg_life_expectancy)<span class="sc">*</span><span class="dv">100</span> <span class="sc">-</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="datawrangling.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rel_dif)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataintro.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jules32/bookdown-tutorial/edit/master/Data_wrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["data.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
